<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Retry logic</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="/css/bootstrap.min.css" rel="stylesheet">
        <link href="/css/vs.css" rel="stylesheet">
        <link href="/css/styles.css" rel="stylesheet">

        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45386460-1', 'hangfire.io');
  ga('send', 'pageview');

</script>
    </head>
    <body>

        <nav class="navbar navbar-fixed-top" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="/">
                <span class="glyphicon glyphicon-fire"></span>
                HangFire
              </a>
            </div>
            <div class="collapse navbar-collapse">
              <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                  <a href="/features/" title="">Features</a>
                </li>
                
                <li >
                  <a href="https://github.com/odinserj/HangFire" title="">Fork me on GitHub</a>
                </li>
                
              </ul>
            </div>
          </div>
        </nav>

        <div class="container">
    <div class="row">
    <div class="col-md-3">
        <ul class="features-sidenav" data-spy="affix" data-offset-top="40" data-offset-bottom="200">
            <li><a href="/features/">Queue-based processing</a></li>
            <li><a href="/features/instance-methods.html">Instance methods</a></li>
            <li><a href="/features/delayed-jobs.html">Delayed jobs</a></li>
            <li><a href="/features/dedicated-thread-pool.html">Dedicated thread pool</a></li>
            <li><a href="/features/multiple-servers.html">Multiple servers</a></li>
            <li><a href="/features/host-agnostic-server.html">Host-agnostic server</a></li>
            <li><a href="/features/retry-logic.html">Retry logic</a></li>
            <li><a href="/features/culture-capturing.html">Culture capturing</a></li>
        </ul>
    </div>
    <div class="col-md-9">
        <h1 class="page-header">Retry logic</h1>
        <p>В HangFire есть два режима повтора задач, неявный и явный. Неявный используется для того, чтобы гарантировать выполнение каждой задачи в HangFire после ее создания. Он используется тогда, когда процесс завершается на некоторой неблагоприятной точке, до или после исполнения задачи. Например, если хост-процесс был завершен до начала выполнения задачи, то при перезапуске она будет выполнена снова. Если хост-процесс был завершен после выполнения задачи, но статус ее выполнения не обновился, она также будет перезапущена.</p>

<div class="callout callout-info">
    <h4>Делайте ваши методы идемпотентными</h4>
    <p>Поскольку гарантию выполнения в сложных условиях, таких, как в ASP.NET можно добиться только повтором задачи, ее стоит сделать идемпотентной. В противном случае результаты ее выполнения могут дублироваться.</p>
</div>

<p>Явный механизм повторного выполнения используется тогда, когда при выполнении пользовательского кода задачи было выброшено исключение. Для того, чтобы иметь возможность перезапуска задачи при транзиентных исключениях или после исправления кода самого метода, в HangFire предусмотрен механизм повторного запуска.</p>

<p>Для того, чтобы задача была автоматически повторена после исключения в коде, примените к ее методу атрибут <code>RetryAttribute</code>:</p>
<div class="highlight"><pre><code class="csharp language-csharp" data-lang="csharp"><span class="na">[Retry(3)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Example</span>
<span class="p">{</span>
<span class="na">    [Retry(5)]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">FiveAttempts</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">ThreeAttempts</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

<span class="na">    [Retry(0)]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">ZeroAttempts</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">BackgroundJob</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">&lt;</span><span class="n">Example</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">FiveAttempts</span><span class="p">());</span>
<span class="n">BackgroundJob</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">&lt;</span><span class="n">Example</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">ThreeAttempts</span><span class="p">());</span>
<span class="n">BackgroundJob</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">&lt;</span><span class="n">Example</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">ZeroAttempts</span><span class="p">());</span>
</code></pre></div>
<div class="callout callout-info">
    <h4>Включено по-умолчанию</h4>
    <p>Этот атрибут применяется по-умолчанию ко всем задачам с количеством попыток, равным 3.</p>
</div>

<div class="callout callout-warning">
    <h4>Повтор все-равно возможен</h4>
    <p>Если вы установите количество попыток в атрибуте равное нулю, то это говорит лишь о том, что она не будет выполнена при возникновении исключении внутри ее метода.</p>
    <p>Повтор такой задачи все-равно возможен, в случаях неявного повтора, описанных выше.</p>
</div>

<div class="callout callout-info">
    <h4>Пример расширения</h4>
    <p>Атрибут <code>RetryAttribute</code> является примером расширения процесса изменения состояния задачи.</p>
</div>


        <ul class="pager">
            
            <li class="previous"><a href="/features/host-agnostic-server.html">&larr; Host-agnostic Server</a></li>
            
            
            <li class="next"><a href="/features/culture-capturing.html">Culture capturing &rarr;</a></li>
            
        </ul>

        <hr>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'hangfire'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
</div>
</div>
        

        <div class="container">
          <hr>

          <footer>
            <p>&copy; 2013-2014 <a href="https://github.com/odinserj">Sergey Odinokov</a></p>
          </footer>
        </div> <!-- /container -->

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="/js/bootstrap.min.js"></script>
        <script src="/js/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
