---
layout: feature
title: Retry logic
prev_slug: host-agnostic-server
prev_text: Host-agnostic Server
next_slug: culture-capturing
next_text: Culture capturing
---

В HangFire есть два режима повтора задач, неявный и явный. Неявный используется для того, чтобы гарантировать выполнение каждой задачи в HangFire после ее создания. Он используется тогда, когда процесс завершается на некоторой неблагоприятной точке, до или после исполнения задачи. Например, если хост-процесс был завершен до начала выполнения задачи, то при перезапуске она будет выполнена снова. Если хост-процесс был завершен после выполнения задачи, но статус ее выполнения не обновился, она также будет перезапущена.

<div class="callout callout-info">
    <h4>Делайте ваши методы идемпотентными</h4>
    <p>Поскольку гарантию выполнения в сложных условиях, таких, как в ASP.NET можно добиться только повтором задачи, ее стоит сделать идемпотентной. В противном случае результаты ее выполнения могут дублироваться.</p>
</div>

Явный механизм повторного выполнения используется тогда, когда при выполнении пользовательского кода задачи было выброшено исключение. Для того, чтобы иметь возможность перезапуска задачи при транзиентных исключениях или после исправления кода самого метода, в HangFire предусмотрен механизм повторного запуска.

Для того, чтобы задача была автоматически повторена после исключения в коде, примените к ее методу атрибут `RetryAttribute`:

```csharp
[Retry(3)]
public class Example
{
    [Retry(5)]
    public void FiveAttempts() { }

    public void ThreeAttempts() { }

    [Retry(0)]
    public void ZeroAttempts() { }
}

BackgroundJob.Enqueue<Example>(x => x.FiveAttempts());
BackgroundJob.Enqueue<Example>(x => x.ThreeAttempts());
BackgroundJob.Enqueue<Example>(x => x.ZeroAttempts());
```

<div class="callout callout-info">
    <h4>Включено по-умолчанию</h4>
    <p>Этот атрибут применяется по-умолчанию ко всем задачам с количеством попыток, равным 3.</p>
</div>

<div class="callout callout-warning">
    <h4>Повтор все-равно возможен</h4>
    <p>Если вы установите количество попыток в атрибуте равное нулю, то это говорит лишь о том, что она не будет выполнена при возникновении исключении внутри ее метода.</p>
    <p>Повтор такой задачи все-равно возможен, в случаях неявного повтора, описанных выше.</p>
</div>

<div class="callout callout-info">
    <h4>Пример расширения</h4>
    <p>Атрибут <code>RetryAttribute</code> является примером расширения процесса изменения состояния задачи.</p>
</div>